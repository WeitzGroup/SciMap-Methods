"0","    #NOTE THAT WE ARE CURRENTLY MISSING ELECTION RETURNS FROM ALASKA"
"0",""
"0",""
"0","# urbanicity <- read.csv(""data/Ruralurbancontinuumcodes2023.csv"") %>%"
"0","#                 mutate(FIPS = str_pad(FIPS, 5, pad = ""0"")) %>%"
"0","#                 filter(Attribute==""RUCC_2023"") %>%"
"0","#                 mutate(urban = ifelse(Value %in% c(""1"", ""2"", ""3""), TRUE, FALSE)) %>%"
"0","#                 select(FIPS, urban) %>%"
"0","#                 distinct() "
"0",""
"0","# why is the IDC loss for 3714 $1??"
"0",""
"0","get_legend_35 <- function(plot) {"
"0","  # return all legend candidates"
"0","  legends <- get_plot_component(plot, ""guide-box"", return_all = TRUE)"
"0","  # find non-zero legends"
"0","  nonzero <- vapply(legends, \(x) !inherits(x, ""zeroGrob""), TRUE)"
"0","  idx <- which(nonzero)"
"0","  # return first non-zero legend if exists, and otherwise first element (which will be a zeroGrob) "
"0","  if (length(idx) > 0) {"
"0","    return(legends[[idx[1]]])"
"0","  } else {"
"0","    return(legends[[1]])"
"0","  }"
"0","}"
"0",""
"0",""
"0","hist_lim <- max(comp$IDC_econ_loss[comp$static_IDC_loss==0],"
"0","                comp$terminated_econ_loss[comp$static_term_loss==0])"
"0",""
"0","points_lim <- range(c(comp$IDC_econ_loss[comp$static_IDC_loss!=0],"
"0","                  comp$static_IDC_loss[comp$static_IDC_loss!=0]))[2]"
"0",""
"0","f_urba <- comp %>%"
"0","          filter(static_IDC_loss == 0) %>%"
"0","          ggplot() +"
"0","            geom_histogram(aes(x=IDC_econ_loss, fill=urban), alpha=.5, position=""identity"") +"
"0","                        scale_x_continuous(transform=log10pseudo_trans,"
"0","                               breaks=c(0, 10^seq(1, 8, by=1)),"
"0","                               labels = c(""0"",""10"", ""100"", ""1K"", ""10K"", ""100K"", ""1M"", ""10M"", ""100M""),"
"0","                               limits=c(0, hist_lim))+"
"0","            geom_text_npc(aes(npcx = ""left"", npcy = ""top"",#hjust=0, vjust=1, "
"0","                              label = paste0(""No local affected orgs. \n("", "
"0","                                     sum(comp$static_IDC_loss==0), "" counties)"")), "
"0","                          label.size=2, size.unit = ""pt"", check_overlap=T)+"
"0","            xlab(""Commuter: Economic Loss ($)"")+"
"0","            ylab(""Count"")+"
"0","            # annotate(""text"", y = 450, x = 0, hjust=1, vjust = 0, size=3,"
"0","            #           label = paste0(""No Local Affected Organizations \n("","
"0","            #                          sum(comp$static_IDC_loss==0), "" counties)""))+"
"0","            theme_classic()+"
"0","            theme(plot.margin = margin(40, 15, 5, 5),"
"0","                  axis.text = element_text(size = 9),"
"0","                  axis.title = element_text(size = 11),"
"0","                  plot.title = element_text(size = 11, face = ""bold"", hjust=1, vjust = 1.1))+"
"0","            scale_fill_manual("""", values = c(""FALSE"" = ""#5BA300"", ""TRUE"" = ""blue""),"
"0","                              labels = c(""FALSE"" = ""Non-metro"", ""TRUE"" = ""Metro"")) +"
"0","            theme(legend.position=""bottom"")"
"2","Warning: [38;5;252mIgnoring unknown parameters: `label.size` and `size.unit`[39m"
"0","f_urbb <- comp %>%"
"0","          filter(static_IDC_loss != 0) %>%"
"0","          ggplot() +"
"0","            geom_point(shape = 1, aes(y=IDC_econ_loss, x=static_IDC_loss, color=urban)) +"
"0","            scale_y_continuous(transform=log10pseudo_trans,"
"0","                               breaks=c(0, 10^seq(1, 8, by=1)),"
"0","                               labels = c(""0"",""10"", ""100"", ""1K"", ""10K"", ""100K"", ""1M"", ""10M"", ""100M""),"
"0","                               limits=c(1000, points_lim))+"
"0","            scale_x_continuous(transform=log10pseudo_trans,"
"0","                               breaks=c(0, 10^seq(1, 8, by=1)),"
"0","                               labels = c(""0"",""10"", ""100"", ""1K"", ""10K"", ""100K"", ""1M"", ""10M"", ""100M""),"
"0","                               limits=c(1000, points_lim))+"
"0","            xlab(""Static: Economic Loss ($)"")+"
"0","            ylab(""Commuter: Economic Loss ($)"")+"
"0","            geom_text_npc(aes(npcx = ""left"", npcy = ""top"",#hjust=0, vjust=1, "
"0","                            label = paste0(""Local affected orgs. \n("", "
"0","                                   sum(comp$static_IDC_loss!=0), "" counties)"")), "
"0","                        label.size=2, size.unit = ""pt"", check_overlap=T)+"
"0","            geom_abline(slope=1, intercept=0, color=""darkred"")+"
"0","            theme_classic()+"
"0","            theme(plot.margin = margin(40, 15, 5, 5),"
"0","                  axis.text = element_text(size = 9),"
"0","                  axis.title = element_text(size = 11),"
"0","                  plot.title = element_text(size = 11, face = ""bold"", hjust=1, vjust = 1.1))+"
"0","            scale_color_manual("""", values = c(""FALSE"" = ""#5BA300"", ""TRUE"" = ""blue""),"
"0","                              labels = c(""FALSE"" = ""Non-metro"", ""TRUE"" = ""Metro"")) +"
"0","            theme(legend.position=""none"")"
"2","Warning: [38;5;252mIgnoring unknown parameters: `label.size` and `size.unit`[39m"
"0","urb_leg <- get_legend_35(f_urba)"
"2","Warning: [38;5;252mAll aesthetics have length 1, but the data has 2768 rows.
[36mâ„¹[38;5;252m Please consider using `annotate()` or provide this layer with data containing a single row.[39m"
"2","[38;5;252m`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.[39m"
"2","Warning: [38;5;252mRemoved 4 rows containing missing values or values outside the scale range (`geom_bar()`).[39m"
"0","urb_plot <- plot_grid(f_urba+theme(legend.position=""none""), f_urbb, nrow = 1,"
"0","                      labels=c(""A. Economic Losses from Proposed IDC Cap \nin Counties without Local Affected Organizations"", ""B. Economic Losses from Proposed IDC Cap \nin Counties with Local Affected Organizations""),"
"0","          hjust=0, label_size=11, align=""h"") %>%"
"0","              plot_grid(., urb_leg, nrow=2, rel_heights = c(9,1))"
"2","Warning: [38;5;252mAll aesthetics have length 1, but the data has 2768 rows.
[36mâ„¹[38;5;252m Please consider using `annotate()` or provide this layer with data containing a single row.[39m"
"2","[38;5;252m`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.[39m"
"2","Warning: [38;5;252mRemoved 4 rows containing missing values or values outside the scale range (`geom_bar()`).[39m"
"2","Warning: [38;5;252mAll aesthetics have length 1, but the data has 376 rows.
[36mâ„¹[38;5;252m Please consider using `annotate()` or provide this layer with data containing a single row.[39m"
"0","hist_lim_CD <- max(comp_CD$IDC_econ_loss[comp_CD$static_IDC_loss==0],"
"0","                comp_CD$terminated_econ_loss[comp_CD$static_term_loss==0])"
"0",""
"0","points_lim_CD <- range(c(comp_CD$IDC_econ_loss[comp_CD$static_IDC_loss!=0],"
"0","                  comp_CD$static_IDC_loss[comp_CD$static_IDC_loss!=0]))"
"0",""
"0","f_para <- comp_CD %>% "
"0","          filter(static_IDC_loss == 0 & !is.na(pol_party) & pol_party != ""Vacant"") %>%"
"0","          ggplot() +"
"0","            geom_histogram(aes(x=IDC_econ_loss, fill=pol_party), alpha=.5, position=""identity"") + "
"0","            scale_x_continuous(transform=log10pseudo_trans,"
"0","                               breaks=c(0, 10^seq(1, 8, by=1)),"
"0","                               labels = c(""0"",""10"", ""100"", ""1K"", ""10K"", ""100K"", ""1M"", ""10M"", ""100M""),"
"0","                              limits=c(0, hist_lim_CD))+"
"0","            xlab(""Commuter: Economic Loss ($)"")+"
"0","            ylab(""Count"")+"
"0","            geom_text_npc(aes(npcx = ""left"", npcy = ""top"",#hjust=0, vjust=1, "
"0","                            label = paste0(""No local affected orgs. \n("", "
"0","                                   sum(comp_CD$static_IDC_loss==0), "" districts)"")), "
"0","                        label.size=2, size.unit = ""pt"", check_overlap=T)+"
"0","            theme_classic()+"
"0","            theme(plot.margin = margin(40, 15, 5, 5),"
"0","                  axis.text = element_text(size = 9),"
"0","                  axis.title = element_text(size = 11),"
"0","                  plot.title = element_text(size = 11, face = ""bold"", hjust=1, vjust = 1.1))+"
"0","            scale_fill_manual("""", values = c(""Republican"" = ""#E81B23"", ""Democrat"" = ""#1666CB"")) +"
"0","            theme(legend.position=""bottom"")"
"2","Warning: [38;5;252mIgnoring unknown parameters: `label.size` and `size.unit`[39m"
"0","f_parb <- comp_CD %>% "
"0","          filter(static_IDC_loss != 0 & !is.na(pol_party) & pol_party != ""Vacant"") %>%"
"0","          ggplot() +"
"0","            geom_point(shape = 1, aes(y=IDC_econ_loss, x=static_IDC_loss, color=pol_party)) + "
"0","            scale_y_continuous(transform=log10pseudo_trans,"
"0","                               breaks=c(0, 10^seq(1, 8, by=1)),"
"0","                               labels = c(""0"",""10"", ""100"", ""1K"", ""10K"", ""100K"", ""1M"", ""10M"", ""100M""),"
"0","                               limits=c(1000,points_lim_CD[2]))+"
"0","            scale_x_continuous(transform=log10pseudo_trans,"
"0","                               breaks=c(0, 10^seq(1, 8, by=1)),"
"0","                               labels = c(""0"",""10"", ""100"", ""1K"", ""10K"", ""100K"", ""1M"", ""10M"", ""100M""),"
"0","                               limits=c(1000,points_lim_CD[2]))+"
"0","            xlab(""Static: Economic Loss ($)"")+"
"0","            ylab(""Commuter: Economic Loss ($)"")+"
"0","            geom_text_npc(aes(npcx = ""left"", npcy = ""top"",#hjust=0, vjust=1, "
"0","                            label = paste0(""Local affected orgs. \n("", "
"0","                                   sum(comp_CD$static_IDC_loss!=0), "" districts)"")), "
"0","                        label.size=2, size.unit = ""pt"", check_overlap=T)+"
"0","            # annotate(""text"", x = 1.5*10^9, y = 1000, hjust=1, vjust = 0, size=3,"
"0","            #         label = paste0(""Local Affected Organizations \n("", "
"0","            #                        sum(comp$static_IDC_loss!=0), "" counties)""))+"
"0","            geom_abline(slope=1, intercept=0, color=""darkred"")+"
"0","            theme_classic()+"
"0","            theme(plot.margin = margin(40, 15, 5, 5),"
"0","                  axis.text = element_text(size = 9),"
"0","                  axis.title = element_text(size = 11),"
"0","                  plot.title = element_text(size = 11, face = ""bold"", hjust=1, vjust = 1.1))+"
"0","            scale_color_manual("""", values = c(""Republican"" = ""#E81B23"", ""Democrat"" = ""#1666CB"")) +"
"0","            theme(legend.position=""none"")"
"2","Warning: [38;5;252mIgnoring unknown parameters: `label.size` and `size.unit`[39m"
"0","par_leg <- get_legend_35(f_para)"
"2","Warning: [38;5;252mAll aesthetics have length 1, but the data has 77 rows.
[36mâ„¹[38;5;252m Please consider using `annotate()` or provide this layer with data containing a single row.[39m"
"2","[38;5;252m`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.[39m"
"2","Warning: [38;5;252mRemoved 4 rows containing missing values or values outside the scale range (`geom_bar()`).[39m"
"0","par_plot <- plot_grid(f_para+theme(legend.position=""none""), f_parb, nrow = 1,"
"0","                      labels=c(""C. Economic Losses from Proposed IDC Cap \nin Districts without Local Affected Organizations"", ""D. Economic Losses from Proposed IDC Cap \nin Districts with Local Affected Organizations""),"
"0","          hjust=0, label_size=11, align=""h"") %>%"
"0","              plot_grid(., par_leg, nrow=2, rel_heights = c(9,1))"
"2","Warning: [38;5;252mAll aesthetics have length 1, but the data has 77 rows.
[36mâ„¹[38;5;252m Please consider using `annotate()` or provide this layer with data containing a single row.[39m"
"2","[38;5;252m`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.[39m"
"2","Warning: [38;5;252mRemoved 4 rows containing missing values or values outside the scale range (`geom_bar()`).[39m"
"2","Warning: [38;5;252mAll aesthetics have length 1, but the data has 359 rows.
[36mâ„¹[38;5;252m Please consider using `annotate()` or provide this layer with data containing a single row.[39m"
"0","plot_grid(urb_plot, par_plot, nrow=2)"
